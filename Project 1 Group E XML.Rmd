---
title: "Project 1 Goup E XML"
author: "Phillip Rodriguez-Lebron & Adam Weimerskirch"
date: "6/8/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r libraries, message = FALSE, warning = FALSE}

library(xml2)
library(tidyverse)
library(dplyr)
library(knitr)
library(kableExtra)
library(DT)
library(GGally)

```

```{r dataset table}

xml <- read_xml("http://www.ggobi.org/book/data/australian-crabs.xml")

records <- xml_find_all(xml, "//record")

text <- xml_text(records)
text <- str_remove_all(text, "[\n]")
text <- text[-c(201:208)]


getTable <- function(x){

  split <- strsplit(x[1:200], " ")
  
  split.df <- data.frame(matrix(unlist(split), nrow = length(split), byrow = TRUE),                   stringsAsFactors = FALSE)
  
  split.tbl <- tbl_df(split.df)
  
  a <- split.tbl %>% rename(Species = X1, Sex = X2, Index = X3, "Frontal Lip" = X4,
                     "Rear Width" = X5, "Carapace Length" = X6, "Carapace Width" = X7,                       "Body Depth" = X8) %>% mutate(Species = as.factor(Species), 
                     Sex = as.factor(Sex)) %>% mutate_if(is.character, as.numeric) %>%
                     mutate(Species = recode(Species, "0" = "Blue",  "1" = "Orange")) %>%  mutate(Sex = recode(Sex, "0" = "Male", "1" = "Female"))
  
  return(a)

}

crab.table <- getTable(text)

datatable(crab.table)

```

```{r sizeGroups}

sizeGroups <- function(x){
  if(!is.vector(x)){
    stop("Please provide vector to classify into groups")
  }
  
  small <- quantile(x, 0.25)
  large <- quantile(x, 0.75)
  
  ifelse(x < small, "Small", ifelse((x >= small) & (x <= large), "Medium", "Large"))
}

crab.table <- crab.table %>%
  mutate(FLGroup = sizeGroups(crab.table$`Frontal Lip`),
         RWGroup = sizeGroups(crab.table$`Rear Width`),
         CLGroup = sizeGroups(crab.table$`Carapace Length`),
         CWGroup = sizeGroups(crab.table$`Carapace Width`),
         BDGroup = sizeGroups(crab.table$`Body Depth`))
```

```{r contingency table}

small <- quantile(crab.table$`Body Depth`, 0.25)
large <- quantile(crab.table$`Body Depth`, 0.75)

getBodyDepth <- function(x){
  
  ifelse(x < small, "Small", ifelse((x >= small) & (x <= large), "Medium", "Large"))
  
}

change <- crab.table %>% mutate(`Body Depth` = getBodyDepth(`Body Depth`))

table(change$Sex, change$`Body Depth`) %>% kable(caption = "The Sex of Crabs by Body Depth") %>% kable_styling()

```

The barplot below shows that this dataset contains `n = 50` crabs in each Sex-Species group.

```{r bar}
g <- ggplot(crab.table)

#barplot
g + geom_bar(aes(x = Species, fill = Sex))
```

The boxplot below shows that the Orange species is has a larger body depth than the the Blue species, for both males and females. 

```{r box}
g <- ggplot(crab.table)

#boxplot
g + geom_boxplot(aes(y = `Body Depth`, fill = Sex)) + facet_grid( ~ Species)
```

The scatterplot below shows that carapace width and length have a strong positive correlation, regardless of sex or species.

```{r scatter}
g <- ggplot(crab.table)

#scatterplot
g + geom_point(aes(x = `Carapace Width`, y = `Carapace Length`)) + 
  facet_grid(Sex ~ Species)
```

The pairs plot below shows that each the size measurements for the crabs are positively correlated with the others.  That is, as one dimension of the crab grows, each other dimension tends to grow as well.

```{r pairs}
#scatterplot pairs
ggpairs(crab.table, columns = 4:8)

```
