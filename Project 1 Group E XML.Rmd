---
title: "Project 1 Goup E XML"
author: "Phillip Rodriguez-Lebron & Adam Weimerskirch"
date: "6/8/2019"
output:
  html_document:
    toc: TRUE
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r libraries, message = FALSE, warning = FALSE}

library(xml2)
library(tidyverse)
library(dplyr)
library(knitr)
library(kableExtra)
library(DT)
library(GGally)

```

# Crab Measurement Data

## Data Table

```{r dataset table}

xml <- read_xml("http://www.ggobi.org/book/data/australian-crabs.xml")

records <- xml_find_all(xml, "//record")

text <- xml_text(records)
text <- str_remove_all(text, "[\n]")
text <- text[-c(201:208)]


getTable <- function(x){

  split <- strsplit(x[1:200], " ")
  
  split.df <- data.frame(matrix(unlist(split), nrow = length(split), byrow = TRUE),                   stringsAsFactors = FALSE)
  
  split.tbl <- tbl_df(split.df)
  
  a <- split.tbl %>% rename(Species = X1, Sex = X2, Index = X3, "Frontal Lip" = X4,
                     "Rear Width" = X5, "Carapace Length" = X6, "Carapace Width" = X7,                       "Body Depth" = X8) %>% mutate(Species = as.factor(Species), 
                     Sex = as.factor(Sex)) %>% mutate_if(is.character, as.numeric) %>%
                     mutate(Species = recode(Species, "0" = "Blue",  "1" = "Orange")) %>%  mutate(Sex = recode(Sex, "0" = "Male", "1" = "Female"))
  
  return(a)

}

crab.table <- getTable(text)

datatable(crab.table)

```

```{r sizeGroups}

sizeGroups <- function(x){
  if(!is.vector(x)){
    stop("Please provide vector to classify into groups")
  }
  
  small <- quantile(x, 0.25)
  large <- quantile(x, 0.75)
  
  ifelse(x < small, "Small", ifelse((x >= small) & (x <= large), "Medium", "Large"))
}

crab.table <- crab.table %>%
  mutate(FLGroup = sizeGroups(crab.table$`Frontal Lip`),
         RWGroup = sizeGroups(crab.table$`Rear Width`),
         CLGroup = sizeGroups(crab.table$`Carapace Length`),
         CWGroup = sizeGroups(crab.table$`Carapace Width`),
         BDGroup = sizeGroups(crab.table$`Body Depth`))
```

## Contingency Tables

```{r contingency table}

table(crab.table$Sex, crab.table$Species) %>% kable(caption = "Sex and Species of Crabs") %>% kable_styling()

table(crab.table$Sex, crab.table$BDGroup) %>% kable(caption = "The Body Depth of Crabs by Sex") %>% kable_styling()

table(crab.table$Species, crab.table$BDGroup) %>% kable(caption = "The Body Depth of Crabs by Species") %>% kable_styling()

table(crab.table$RWGroup, crab.table$FLGroup) %>% kable(caption = "The Frontal Lip of Crabs by Rear Width") %>% kable_styling()

```

## Plots

### One Variable Plots

The barplots below are visual depictions of the first two contingency tables.

```{r bar}
g <- ggplot(crab.table)

#barplot
g + geom_bar(aes(x = Species, fill = Sex))
g + geom_bar(aes(x = Sex, fill = BDGroup))
```

The boxplot below shows that the Orange species is has a larger body depth than the the Blue species, for both males and females. 

```{r box}
g <- ggplot(crab.table)

#boxplot
g + geom_boxplot(aes(y = `Body Depth`, fill = Sex)) + facet_grid( ~ Species)
```

### Two Variable Plots

The scatterplot below shows that carapace width and length have a strong positive correlation, regardless of sex or species.

```{r scatter}
g <- ggplot(crab.table)

#scatterplot
g + geom_point(aes(x = `Carapace Width`, y = `Carapace Length`)) + 
  facet_grid(Sex ~ Species)
```

The pairs plot below shows that each the size measurements for the crabs are positively correlated with the others.  That is, as one dimension of the crab grows, each other dimension tends to grow as well.

```{r pairs, message = FALSE}
#scatterplot pairs
ggpairs(crab.table, columns = 4:8)

```

From these plots, it appears that the width variables have a bimodal distribution as the crabs increase in size.  It seems likely that a categorical variable (possibly species or sex) plays a role in this relationship.  It would be interesting to do some linear modelling with this dataset to see which variables are most predictive those width variables.

```{r density}
g <- ggplot(crab.table)

#densities of width variables
g + geom_density(aes(x = `Rear Width`)) +
  facet_grid(Sex ~ Species)
```